<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.17"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Chil: CHIL - C++ hardware-in-the-loop testing</title>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
        <script type="text/javascript" src="jquery.smartmenus.js"></script>
        <!-- SmartMenus jQuery Bootstrap Addon -->
        <script type="text/javascript" src="jquery.smartmenus.bootstrap.js"></script>
        <!-- SmartMenus jQuery plugin -->
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Chil 1.0.0</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;position: initial;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generado por Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Buscar');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Buscar');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CHIL - C++ hardware-in-the-loop testing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/joacomf/chil/actions/workflows/pipeline.yml"><object type="image/svg+xml" data="https://github.com/joacomf/chil/actions/workflows/pipeline.yml/badge.svg?branch=master" style="pointer-events: none;">Pipeline</object></a> <a href="https://codecov.io/gh/joacomf/chil"><object type="image/svg+xml" data="https://codecov.io/gh/joacomf/chil/branch/master/graph/badge.svg?token=LNUE0ZBNP4" style="pointer-events: none;">codecov</object></a> <a href="https://registry.platformio.org/libraries/joacomf/Chil"><object type="image/svg+xml" data="https://badges.registry.platformio.org/packages/joacomf/library/Chil.svg" style="pointer-events: none;">PlatformIO Registry</object></a></p>
<p>Framework para escribir pruebas utilizando un dispositivo físico como ejecutor.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Tabla de contenido</h1>
<ul>
<li><a href="#motivacin">Motivación</a></li>
<li><a href="#usos">Usos</a></li>
<li><a href="#modo-de-uso">Modo de uso</a><ul>
<li><a href="#creacin-del-proyecto">Creación del proyecto</a></li>
<li><a href="#creacin-del-contexto-de-pruebas">Creación del contexto de pruebas</a></li>
<li><a href="#definicin-de-escenarios">Definición de escenarios</a></li>
<li><a href="#ejecucin">Ejecución</a></li>
</ul>
</li>
<li><a href="#contribucin">Contribución</a><ul>
<li><a href="#entorno">Entorno</a></li>
<li><a href="#construccin">Constucción</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Motivación</h1>
<p>La motivación original detrás de todo el proyecto fue la necesidad de crear una herramienta que sea habilitante para realizar prácticas con pruebas automatizadas (TDD, BDD, Integración Continua) al mundo de microcontroladores que está creciendo.</p>
<p>Desde hace varios años, el mercado de microcontroladores fue mutando y por ende emergieron nuevas generaciones de procesadores con mayor espacio y mayor capacidad de cómputo que permite poner software de tamaño considerable (hasta MBs) lo que genera un crecimiento en la complejidad del mismo.</p>
<p>Antes se programaban dispositivos con una cantidad limitada de condiciones lo que permitía verificar rápidamente de manera manual si cumplía con el funcionamiento adecuado.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Usos</h1>
<p>Varios usos pueden ser interpretados de esta herramienta. Algunos ejemplos:</p><ol type="1">
<li>Usarlo como herramienta para guiar el desarrollo. Se puede usar en la práctica de BDD/ATDD para definir el comportamiento del producto y a partir realizar el desarrollo para que cumpla con esas especificaciones/comportamiento.</li>
<li>Se puede utilizar como herramienta para probar el desarrollo luego de haberlo realizado, de manera de dejar un arnés de seguridad para el código escrito</li>
<li>Otro uso puede ser armar una red de contención previo a una refactorización de código heredado. A partir de cómo se debería comportar el dispositivo, se escriben las pruebas y una vez que las mismas otorguen feedback adecuado se puede proceder a refactorizar el código.</li>
<li>Un uso menos común pero igual de válido es para explorar un producto a partir de lo que uno piensa que debería hacer, un ejemplo de este caso es la aplicación de ingeniería inversa si es que no se tiene el código del dispositivo aún o si el mismo es difícil de entender.</li>
<li>Cualquier otro propósito que ayude al procesos de construir algún producto</li>
</ol>
<h1><a class="anchor" id="autotoc_md4"></a>
Modo de uso</h1>
<p>Se pueden encontrar algunos ejemplos de uso completos con proyectos de muestra en la <a href="./ejemplos">carpeta de ejemplos</a></p>
<h2><a class="anchor" id="autotoc_md5"></a>
Creación del proyecto</h2>
<p>A la hora de crear un proyecto nuevo se debe crear para la plataforma que será encargada de ejecutar las pruebas. Para ello se pueden utilizar cualquier tipo de herramienta para realizar la construcción del código, la instalación en el dispositivo y el monitoreo a través de Serial. Herramientas de este tipo puede ser <a href="https://platformio.org/">Platformio</a> que permite realizar un setup rápido.</p>
<p>Lo importante es que se pueda observar el output enviado al puerto <code>Serial</code>, ya que es el lugar por el cual se muestra el avance y resultado de las pruebas.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Importar la librería</h3>
<p>(A modo de referencia se utilizarán ejemplos para plataforma ESP)</p>
<p>Hay dos maneras de hacer esto:</p><ol type="1">
<li><b>[Recomendada] Importación utiliazando el gestor de dependencias de <a href="https://platformio.org/">Platformio</a></b>: se debe agregar al <code>platformio.ini</code>. <div class="fragment"><div class="line">lib_deps =</div>
<div class="line">    joacomf/Chil</div>
<div class="line">    joacomf/Chil-plataforma-ESP</div>
</div><!-- fragment --></li>
<li><b>Import manual</b>: Descargando el último empaquetado de codigo fuente de la herramienta desde la sección <a href="https://github.com/joacomf/chil/releases">releases del repositorio</a> e importandolo con CMake u otra herramienta utilizada para gestión de dependencias proyectos C++. \ Lo mismo pero para la plataforma a utilizar, como la de ESP desde la sección <a href="https://github.com/joacomf/chil-plataforma-esp/releases">releases del repositorio de ESP</a></li>
</ol>
<h3><a class="anchor" id="autotoc_md7"></a>
Estructura de archivos mínima</h3>
<p>Utilzando import platformIO debería ser </p><div class="fragment"><div class="line">proyecto/</div>
<div class="line">├─ .pio/</div>
<div class="line">├─ src/</div>
<div class="line">│  ├─ main.cpp</div>
<div class="line">├─ CMakeLists.txt</div>
<div class="line">├─ CMakeListsPrivate.txt</div>
<div class="line">├─ platformio.ini</div>
<div class="line">├─ README.md</div>
</div><!-- fragment --><p>Utilizando import manual </p><div class="fragment"><div class="line">proyecto/</div>
<div class="line">├─ src/</div>
<div class="line">│  ├─ main.cpp</div>
<div class="line">├─ .gitignore</div>
<div class="line">├─ CMakeLists.txt</div>
<div class="line">├─ README.md</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Creación del contexto de pruebas</h2>
<p>Para poder comenzar a escribir casos de prueba/ejemplos/escenarios de comportamiento, primero se debe configurar la herramienta para tener el contexto de ejecución listo</p>
<p>Para ello en el archivo <code><a class="el" href="main_8cpp.html">main.cpp</a></code> del proyecto de pruebas </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &lt;PlataformaESP.h&gt;</div>
<div class="line">#include &lt;Chil.h&gt;</div>
<div class="line"> </div>
<div class="line">PRUEBAS;</div>
<div class="line"> </div>
<div class="line">    NUEVO_CHIL_CON(PLATAFORMA_ESP);</div>
<div class="line">    // Definir la entrada/salida del dispositivo</div>
<div class="line">    </div>
<div class="line">    // Aquí va la sección de </div>
<div class="line">    // escenarios detallada más adelante</div>
<div class="line"> </div>
<div class="line">    FIN_DE_PRUEBAS;</div>
<div class="line"> </div>
<div class="line">FIN;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Definición de escenarios</h2>
<p>Para definir los casos de pruebas existen dos macros que ayudan a definir los mismos.</p>
<p>La primer macro <code>ESCENARIO</code> permite definir el ejemplo concreto/comportamiento de uso del dispositivo.</p>
<p>Luego cada <a class="el" href="classEscenario.html">Escenario</a> contiene multiples <code>PASO</code> en donde se define una acción concreta para llevar una parte de la representación de ese ejemplo.</p>
<p>Tomando el <a href="./ejemplos/leds">ejemplo de los LEDs</a> podemos definir un escenario como el siguiente: </p><div class="fragment"><div class="line">1. Al presionar por primera vez el botón enciende el led</div>
<div class="line">    - Cuando presiono el botón</div>
<div class="line">    - Espero que encienda</div>
<div class="line">    - Verifico que el led se enciende</div>
<div class="line">    - Suelto el botón</div>
</div><!-- fragment --><p>Utilizando las herramientas brindadas por <a class="el" href="classChil.html">Chil</a>, ese escenario puede definirse: ```c++ <a class="el" href="macros_8h.html#a1e52795296e49d76c806269e7fcfc4f3">ESCENARIO(Al presionar por primera vez el boton enciende el led)</a>{ PASO(Cuando presiono el boton, []() { PLATAFORMA-&gt;escribir(BOTON_ROJO, 1); }); PASO(Y espero que encienda, []() { PLATAFORMA-&gt;demorar(25); }); PASO(Verifico que el led se enciende, []() { verificar(PLATAFORMA-&gt;leer(LED_AZUL))-&gt;esIgualA(1); // Es similar a <code>return PLATAFORMA-&gt;leer(LED_AZUL) == 1;</code> }); PASO(Suelto el boton, []() { PLATAFORMA-&gt;escribir(BOTON_ROJO, 0); }); }; ``` Otra manera de definir los escenarios puede ser referenciando a una función, esta aproximación es convieniente cuando se quiere separar la implementación de la definición de los escenarios para poder tener una lectura más clara de estos últimos. Utilizando el mismo ejemplo anterior:</p>
<p>```c++ void presionoElBotonRojo() { PLATAFORMA-&gt;escribir(BOTON_ROJO, 1); }</p>
<p>void esperoQueEncienda() { PLATAFORMA-&gt;demorar(25); }</p>
<p>void verificoQueElLedEsteEncendido() { verificar(PLATAFORMA-&gt;leer(LED_AZUL))-&gt;esIgualA(1); // Es similar a tener un método boolean con <code>return PLATAFORMA-&gt;leer(LED_AZUL) == 1;</code> }</p>
<p>void sueltoElBotonRojo() { PLATAFORMA-&gt;escribir(BOTON_ROJO, 0); }</p>
<p><a class="el" href="macros_8h.html#a1e52795296e49d76c806269e7fcfc4f3">ESCENARIO(Al presionar por primera vez el boton enciende el led)</a>{ <a class="el" href="macros_8h.html#a99d43b4b18b3de10da3d0e54890e4dd3">PASO(Cuando presiono el boton, presionoElBotonRojo)</a>; <a class="el" href="macros_8h.html#a99d43b4b18b3de10da3d0e54890e4dd3">PASO(Y espero que encienda, esperoQueEncienda)</a>; <a class="el" href="macros_8h.html#a99d43b4b18b3de10da3d0e54890e4dd3">PASO(Verifico que el led se enciende, verificoQueElLedEsteEncendido)</a>; PASO(Suelto el botón, sueltoElBotonRojo); }; </p><div class="fragment"><div class="line">Como se puede observar en los ejemplos anteriores se hace uso de el método `verificar()` el cual pertenece una librería de verificaciones ofrecida por `Chil` se explicará con detalle en la sección [librería de verificación](#librera-de-verificacin).</div>
<div class="line"> </div>
<div class="line">### Librería de verificación</div>
<div class="line">Para facilitar la verificación de valores obtenidos, se propuso una librería (inspirada en [AssertJ](https://assertj.github.io/doc/)), la cual tiene una nómina limitada de métodos para comparar.</div>
<div class="line"> </div>
<div class="line">Tiene dos modos de comparación:</div>
<div class="line">1. El primero es sobre un valor existente y el otro es realizando.</div>
<div class="line">Para su utilización se invoca el método `verificar(valor)` siendo `valor` el dato en cuestión y luego se puede llamar a cualquiera de los métodos de la siguiente lista:</div>
<div class="line"> </div>
<div class="line">- `esVerdadero()`: Corrobora si el valor es verdadero</div>
<div class="line">- `esFalso()`: Corrobora si el valor es falso</div>
<div class="line">- `esIgualA(Tipo valorEsperado)`: Corrobora si el valor es igual al esperado</div>
<div class="line">- `esMayorA(Tipo valorConElCualComparar)`: Corrobora si el valor es mayor</div>
<div class="line">- `esMenorA(Tipo valorConElCualComparar)`: Corrobora si el valor es menor</div>
<div class="line">- `esMayorOIgualA(Tipo valorConElCualComparar)`: Corrobora si el valor es mayor o igual al indicado</div>
<div class="line">- `esMenorOIgualA(Tipo valorConElCualComparar)`: Corrobora si el valor es menor o igual al indicado</div>
<div class="line">- `entre(Tipo valorInferior, Tipo valorSuperior)`: Corrobora si el valor a verificar esta entre dos valores dados [incluidos]</div>
<div class="line">Ejemplo:</div>
<div class="line">```c++</div>
<div class="line">verificar&lt;int&gt;(5)-&gt;esIgualA(5);</div>
</div><!-- fragment --><ol type="1">
<li>El segundo modo es realizando un sondeo repetitivo con cierta acción, un ejemplo donde puede ser útil sondear el valor de una entrada digital.</li>
</ol>
<p>Para su utilización se debe llamar al método <code>comprobar(metodo)</code> siendo <code>método</code> el método a ejecutar cada cierto tiempo. La firma de este método debe devolver un valor booleano indicando si la verificación fue exitosa o no.</p>
<p>Para definir las propiedades del sondeo, se pueden usar los métodos:</p><ul>
<li><code>durante(int milisegundos)</code>: Configura el tiempo límite en milisegundos durante el cual se hará sondeo. Valor por defecto <code>1000</code></li>
<li><code>conIntervaloDe(int milisegundos)</code>: Configura el tiempo de espera entre un sondeo y el siguiente en milisegundos. Valor por defecto <code>1</code></li>
</ul>
<p>Al final se debe cerrar con el método <code>seHayaEjecutado()</code>.</p>
<p>Ejemplo: </p><div class="fragment"><div class="line">{c++}</div>
<div class="line">   comprobar([]() {</div>
<div class="line">       return PLATAFORMA-&gt;leer(PIN_BOTON) == 1;</div>
<div class="line">   })</div>
<div class="line">   -&gt;durante(201)</div>
<div class="line">   -&gt;conIntervaloDe(5)</div>
<div class="line">   -&gt;seHayaEjecutado();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md10"></a>
Ejecución</h2>
<p>Para ejecutar las pruebas sólo basta con compilar el proyecto, empaquetar el binario, grabarlo en el dispositivo y por último observar el monitor serial para ver el resultado de las pruebas.</p>
<p>Para facilitar este trabajo puede utilizarse herramientas como:</p><ul>
<li>Plaformio</li>
<li>Herramienta CLI de <a class="el" href="classChil.html">Chil</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
Herramientas</h3>
<p>Para compilar y subir el código al dispositivo ejecutor de pruebas se utilizará la herramienta de <a href="https://platformio.org/">PlatformIO</a> por lo que es necesario tener instalada la <a href="https://docs.platformio.org/en/latest/core/index.html">CLI (herramienta de línea de comando)</a> como lo explica su documentación.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
CLI de Chil</h3>
<p>Ver la documentación de la herramienta CLI de Chil</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Contribución</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Entorno</h2>
<h3><a class="anchor" id="autotoc_md15"></a>
IDE</h3>
<p>Un IDE recomendado para el desarollo es <a href="https://code.visualstudio.com/">VSCode</a>. También puede utilizarse <a href="https://www.jetbrains.com/es-es/clion/">CLion</a> (No libre).</p>
<p>Al importarlo utilizando la herramienta de <a href="https://platformio.org/">PlatformIO</a>, la misma se encargará de descargar las líbrerias necesarias.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
Herramientas</h3>
<p>El proyecto fue desarrollado en un ambiente con sistema operativo con base linux. Para compilar y ejecutar las pruebas del proyecto, se necesita tener las siguientes librerías:</p><ul>
<li>cmake</li>
<li>build-essentials</li>
</ul>
<p>Para ello en un entorno con base Debian (Ubuntu, LinuxMint, etc): </p><div class="fragment"><div class="line">$ sudo apt install cmake build-essentials</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Construcción</h2>
<p>Para construir el proyecto, se podrá ejecutar el script </p><div class="fragment"><div class="line">./scripts/build.sh</div>
</div><!-- fragment --><p>El mismo se encarga de limpiar el entorno y ejecutar los pasos necesarios para que la construcción sea exitosa. Este script se encargará de instalar las librerías necesarias para ejecutar las pruebas de:</p><ul>
<li><a href="https://github.com/google/googletest">GTEST</a> - GoogleTest, librería de pruebas para C++ de Google</li>
</ul>
<p>Para correr los tests es necesario ejecutar el script </p><div class="fragment"><div class="line">./scripts/test.sh</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generado por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
        <script type="text/javascript" src="doxy-boot.js"></script>
</html>
